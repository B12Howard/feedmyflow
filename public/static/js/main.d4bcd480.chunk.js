(this.webpackJsonpfeedmyflow=this.webpackJsonpfeedmyflow||[]).push([[0],{132:function(e,t,n){e.exports=n(159)},137:function(e,t,n){},149:function(e,t,n){},157:function(e,t,n){},158:function(e,t,n){},159:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(8),c=n.n(o),i=(n(137),n(75)),l=n(47),u=n(49),s=n(194),m=n(22),d=n(119),f=n(210),p=n(190),h=n(191),g=n(88),v=n(160),E=n(192),b=n(193),w=n(87),O=n(62),C=n.n(O),y=n(120),j=n(110),k=n.n(j).a.initializeApp({apiKey:"AIzaSyChVTR8whxQvgeDN_elGu9-xmWB-UpyUbg",authDomain:"feedmyflow.firebaseapp.com",databaseURL:"https://feedmyflow.firebaseio.com",projectId:"feedmyflow",storageBucket:"feedmyflow.appspot.com",messagingSenderId:"159392585747",appId:"1:159392585747:web:4ac62c97775c8b7d7587e6",measurementId:"G-JJ9Z5RNNSC"}),T=Object(a.createContext)();function I(e){var t=e.children,n=S();return r.a.createElement(T.Provider,{value:n},t)}var x=function(){return Object(a.useContext)(T)},S=function(){var e=Object(a.useState)({haveTriedLogin:!1,isConnected:!1,user:void 0,firebaseTestLogin:!1}),t=Object(m.a)(e,2),n=t[0],r=t[1],o=new y.a,c=function(e){return decodeURIComponent((new RegExp("[?|&]"+e+"=([^&;]+?)(&|#|;|$)").exec(window.location.href)||[null,""])[1].replace(/\+/g,"%20"))||null},i=function(e){var t,n;return C.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,a.next=3,C.a.awrap(fetch(e,{method:"GET"}));case 3:return t=a.sent,a.next=6,C.a.awrap(t.json());case 6:return n=a.sent,a.abrupt("return",n);case 10:throw a.prev=10,a.t0=a.catch(0),a.t0;case 13:case"end":return a.stop()}}),null,null,[[0,10]])},l=function(e){return new Promise((function(t,n){console.log("firebase init"),k.auth().signInWithCustomToken(e).then((function(){console.log("loged in"),t()})).catch((function(e){console.log("not loged in"),o.remove("token"),n(e)}))}))},u=function e(t,a){console.log(n),n.firebaseTestLogin||t>=10?n.isConnected?a():window.location.href="https://us-central1-feedmyflow.cloudfunctions.net//redirect":setTimeout((function(){e(t+1,a)}),500)};return Object(a.useEffect)((function(){var e=k.auth().onAuthStateChanged((function(e){e?(console.log("status change connected"),r(Object(w.a)({},n,{isConnected:!0,user:e,haveTriedLogin:!0,firebaseTestLogin:!0}))):(console.log("status change disconnected"),r(Object(w.a)({},n,{isConnected:!1,user:void 0,haveTriedLogin:!1,firebaseTestLogin:!0})))}));return function(){return e()}}),[]),{authStatus:n,signOut:function(e){return k.auth().signOut().then((function(){e.history.push("/"),r(Object(w.a)({},n,{isConnected:!1,user:void 0,haveTriedLogin:!1}))}))},signIn:function(e,t){return new Promise((function(a,r){n.isConnected?a():new Promise((function(e,t){var n,a,r,u;return C.a.async((function(s){for(;;)switch(s.prev=s.next){case 0:if(console.log("try to get Token"),n=c("code"),a=c("state"),null===n){s.next=18;break}return r="https://us-central1-feedmyflow.cloudfunctions.net//token?code="+encodeURIComponent(n)+"&state="+encodeURIComponent(a),s.prev=6,s.next=9,C.a.awrap(i(r));case 9:(u=s.sent).token&&(console.log("info in url"),o.set("token",u.token.toString()),l(u.token).then((function(){return e()})).catch((function(e){return t(e)}))),s.next=16;break;case 13:s.prev=13,s.t0=s.catch(6),t(s.t0);case 16:s.next=20;break;case 18:console.log("no info in url"),new Promise((function(e,t){console.log("try to log with Cookies");var n=void 0;try{n=o.get("token")}catch(a){t(a)}void 0===n?t("no Token"):(console.log("try to use cookies token"),l(n).then((function(){console.log("log with cookies works"),e()})).catch((function(e){console.log("log with cookies failed"),t(e)})))})).then((function(){e()})).catch((function(e){t(e)}));case 20:case"end":return s.stop()}}),null,null,[[6,13]])})).then((function(){e&&t.history.push("/dashboard"),a()})).catch((function(e){console.log(e),console.log("redirect"),u(0,a)}))}))}}},N=(n(149),function(e){var t=x(),n=Object(a.useState)(null),o=Object(m.a)(n,2),c=o[0],i=o[1],l=Boolean(c),u="account-menu",s=r.a.createElement(d.a,{anchorEl:c,anchorOrigin:{vertical:"top",horizontal:"right"},id:u,keepMounted:!0,transformOrigin:{vertical:"top",horizontal:"right"},open:l,onClose:function(){i(null)}},t.authStatus.isConnected?r.a.createElement(f.a,{onClick:function(){return t.signOut(e)}},"Disconnect"):r.a.createElement(f.a,{onClick:function(){return t.signIn(!0,e)}},"Connect"));return r.a.createElement(r.a.Fragment,null,r.a.createElement(p.a,{position:"static",color:"default"},r.a.createElement(h.a,null,r.a.createElement(g.a,{className:"title",variant:"h6"},"FeedMyFlow"),r.a.createElement(v.a,{edge:"end","aria-label":"send mail to dev","aria-controls":u,"aria-haspopup":"true",onClick:function(){window.location.href="mailto:feedmyflow@gmail.com"},color:"inherit"},r.a.createElement(E.a,null)),r.a.createElement(v.a,{edge:"end","aria-label":"account of current user","aria-controls":u,"aria-haspopup":"true",onClick:function(e){i(e.currentTarget)},color:"inherit"},r.a.createElement(b.a,null)))),s)}),D=(Object(u.a)((function(e){return{paper:{marginTop:e.spacing(8),display:"flex",flexDirection:"column",alignItems:"center"},avatar:{margin:e.spacing(1),backgroundColor:e.palette.secondary.main},form:{width:"100%",marginTop:e.spacing(1)},submit:{margin:e.spacing(3,0,2)}}})),function(e){var t=x();return r.a.createElement(r.a.Fragment,null,r.a.createElement(N,e),r.a.createElement(s.a,{onClick:function(){return t.signIn(!0,e)}},"Sign In"))}),U=n(86),L=n(195),M=function(e){var t=x();return Object(a.useEffect)((function(){t.authStatus.haveTriedLogin||t.signIn(!1,null)}),[]),r.a.createElement(L.a,null)},P=function(e){e.component;var t=Object(U.a)(e,["component"]),n=x();return r.a.createElement(l.b,Object.assign({},t,{render:function(e){return n.authStatus.haveTriedLogin?r.a.createElement(l.a,{to:{pathname:n.authStatus.isConnected?"/dashboard":"/",state:{from:e.location}}}):r.a.createElement(M,null)}}))},B=n(98),R=n(204),A=n(196),F=n(121),W=n(207),z=n(199),J=n(161),G=n(206),V=n(200),H=n(201),K=n(202),Y=n(205),$=n(17),q=n(203),Q=n(208),Z=n(118),_=Object(u.a)((function(e){return{modal:{display:"flex",alignItems:"center",justifyContent:"center"}}})),X=Object(a.forwardRef)((function(e,t){var n=void 0!=e.event,o=!1;n&&(o=void 0!=e.event.media);var c=k.firestore(),i=k.auth().currentUser.uid,l=_(),u=r.a.useState(!1),d=Object(m.a)(u,2),p=d[0],h=d[1],v=Object(a.useState)(!1),E=Object(m.a)(v,2),b=E[0],w=E[1],O=Object(a.useState)(!1),C=Object(m.a)(O,2),y=C[0],j=C[1],T=Object(a.useState)(n?new Date(e.event.publicationTime.toDate()):new Date),I=Object(m.a)(T,2),x=I[0],S=I[1],N=Object(a.useState)(n?e.event.shareCommentary:""),D=Object(m.a)(N,2),U=D[0],L=D[1],M=Object(a.useState)(n?e.event.shareMediaCategory:"NONE"),P=Object(m.a)(M,2),B=P[0],R=P[1],F=Object(a.useState)(n?e.event.visibility:"PUBLIC"),X=Object(m.a)(F,2),ee=X[0],te=X[1],ne=Object(a.useState)(n&&o?e.event.media.title:""),ae=Object(m.a)(ne,2),re=ae[0],oe=ae[1],ce=Object(a.useState)(n&&o?e.event.media.description:""),ie=Object(m.a)(ce,2),le=ie[0],ue=ie[1],se=Object(a.useState)(n&&o?e.event.media.originalUrl:""),me=Object(m.a)(se,2),de=me[0],fe=me[1];Object(a.useImperativeHandle)(t,(function(){return{handleOpen:function(){h(!0)}}}));var pe=function(){h(!1)};Object(a.useEffect)((function(){return j(""!==U&&("NONE"===B||""!==re&&""!==le&&""!==de)),function(){w(!0)}}),[x,U,B,ee,re,le,de]);return r.a.createElement(W.a,{"aria-labelledby":"transition-modal-title","aria-describedby":"transition-modal-description",className:l.modal,open:p,onClose:pe,closeAfterTransition:!0,BackdropComponent:z.a,BackdropProps:{timeout:500}},r.a.createElement(J.a,{in:p},r.a.createElement(V.a,null,r.a.createElement(H.a,null,n?r.a.createElement(g.a,{variant:"h5",component:"h2"},"Post pr\xe9vu pour le ",e.event.rawDate," \xe0 ",e.event.rawTime):r.a.createElement(g.a,{variant:"h5",component:"h2"},"Create"),r.a.createElement(K.a,null),r.a.createElement(A.a,{container:!0,spacing:3},r.a.createElement($.a,{utils:Z.a},r.a.createElement(A.a,{item:!0,xs:12,md:3},r.a.createElement(q.a,{margin:"normal",id:"date-picker-dialog",label:"Date picker dialog",format:"dd/MM/yyyy",value:x,onChange:function(e){return S(e)},KeyboardButtonProps:{"aria-label":"change date"}})),r.a.createElement(A.a,{item:!0,xs:12,md:3},r.a.createElement(Q.a,{margin:"normal",id:"time-picker",label:"Time picker",value:x,ampm:!1,minutesStep:15,onChange:function(e){return S(e)},KeyboardButtonProps:{"aria-label":"change time"}}))),r.a.createElement(A.a,{item:!0,xs:12,md:3},r.a.createElement(Y.a,{labelId:"Type de post",id:"shareMediaCategory",value:B,onChange:function(e){return R(e.target.value)}},r.a.createElement(f.a,{value:"NONE"},"Juste Text"),r.a.createElement(f.a,{value:"ARTICLE"},"Avec Article"),r.a.createElement(f.a,{value:"IMAGE"},"Avec Image"))),r.a.createElement(A.a,{item:!0,xs:12,md:3},r.a.createElement(Y.a,{labelId:"Visibilit\xe9",id:"visibility",value:ee,onChange:function(e){return te(e.target.value)}},r.a.createElement(f.a,{value:"PUBLIC"},"Publique"),r.a.createElement(f.a,{value:"CONNECTIONS"},"connexions")))),r.a.createElement(A.a,{container:!0,spacing:3},r.a.createElement(A.a,{item:!0,xs:12},r.a.createElement(G.a,{fullWidth:!0,label:"Contenu du post",id:"shareCommentary",value:U,onChange:function(e){return L(e.target.value)},multiline:!0}))),function(){if("NONE"!==B)return r.a.createElement(A.a,{container:!0,spacing:3},r.a.createElement(A.a,{item:!0,xs:12},r.a.createElement(G.a,{fullWidth:!0,id:"mediaTitle",label:"Titre",value:re,onChange:function(e){return oe(e.target.value)}})),r.a.createElement(A.a,{item:!0,xs:12},r.a.createElement(G.a,{fullWidth:!0,id:"mediaDescription",label:"Description",value:le,onChange:function(e){return ue(e.target.value)},multiline:!0})),r.a.createElement(A.a,{item:!0,xs:12},r.a.createElement(G.a,{fullWidth:!0,id:"mediaUrl",label:"Url",value:de,onChange:function(e){return fe(e.target.value)}})))}(),n?r.a.createElement(r.a.Fragment,null,r.a.createElement(s.a,{variant:"contained",color:"primary",onClick:function(){var t=e.event.id;window.confirm("Etes vous sur de vouloir supprimer ce post ?")&&c.collection("user").doc(i).collection("post").doc(t).delete()}},"Delete"),r.a.createElement(s.a,{variant:"contained",color:"primary",onClick:function(){var t=e.event.id,n={author:"urn:li:person:"+i.split(":")[1],userUID:i,publicationTime:x,shareCommentary:U,visibility:ee,shareMediaCategory:B,rawDate:x.getDate()+"/"+x.getMonth()+"1/"+x.getFullYear(),rawTime:x.getHours()+":"+x.getMinutes()+":00"};"NONE"!==B&&""!==re&&""!==le&&""!==de&&(n.media={title:re,description:le,originalUrl:de}),c.collection("user").doc(i).collection("post").doc(t).update(n),pe(),w(!1)},disabled:!b},"Update")):r.a.createElement(s.a,{variant:"contained",color:"primary",onClick:function(){var e={author:"urn:li:person:"+i.split(":")[1],userUID:i,publicationTime:x,shareCommentary:U,visibility:ee,shareMediaCategory:B,rawDate:x.getDate()+"/"+x.getMonth()+"1/"+x.getFullYear(),rawTime:x.getHours()+":"+x.getMinutes()+":00"};"NONE"!==B&&""!==re&&""!==le&&""!==de&&(e.media={title:re,description:le,originalUrl:de}),c.collection("user").doc(i).collection("post").add(e),pe(),n||(S(new Date),L(""),R("NONE"),te("PUBLIC"),oe(""),ue(""),fe(""))},disabled:!y},"Create")))))})),ee=n(84),te=n.n(ee),ne=(n(155),n(156),n(157),Object(B.b)(te.a)),ae=function(e){var t=Object(a.useState)([]),n=Object(m.a)(t,2),o=n[0],c=n[1],i=Object(a.useRef)(),l=Object(a.useRef)([]),u=void 0,d=void 0,f=k.firestore();Object(a.useEffect)((function(){u=k.auth().currentUser,d=u.uid;var e=f.collection("user").doc(d).collection("post").onSnapshot((function(t){var n=[];return t.docs.map((function(e,t){var a=e.data();a.itemId=t,a.id=e.id,a.title=a.shareCommentary,a.start=new Date(a.publicationTime.toDate()),a.end=te()(a.start).add(15,"m").toDate(),n.push(a)})),n.sort((function(e,t){return e.start-t.start})),c(n),function(){e()}}))}),[]),Object(a.useEffect)((function(){l.current=l.current.slice(0,o.length)}),[o]);return r.a.createElement("div",{className:"App"},r.a.createElement(N,e),r.a.createElement(R.a,{className:"menu"},r.a.createElement(A.a,{container:!0,spacing:2},r.a.createElement(A.a,{item:!0,md:12,lg:8},r.a.createElement(F.a,null,r.a.createElement(B.a,{popup:!0,step:60,localizer:ne,defaultDate:new Date,defaultView:"month",culture:"fr",events:o,drilldownView:"week",style:{height:"85vh"},views:{month:!0,week:!0},onSelectEvent:function(e,t){l.current[e.itemId].handleOpen()}}))),r.a.createElement(A.a,{item:!0,md:12,lg:4},r.a.createElement(s.a,{variant:"contained",color:"primary",onClick:function(){i.current.handleOpen()}},"Create"),r.a.createElement(X,{ref:i}),r.a.createElement(F.a,null,r.a.createElement(g.a,{className:"title",variant:"h6"},"Next post..."),r.a.createElement(r.a.Fragment,null,o.map((function(e){return r.a.createElement("div",{key:e.id},r.a.createElement("p",{onClick:function(){l.current[e.itemId].handleOpen()}},e.rawDate+" "+e.rawTime+" : "+e.title),r.a.createElement(X,{ref:function(t){return l.current[e.itemId]=t},event:e}))}))))))))},re=function(e){var t=e.comp,n=Object(U.a)(e,["comp"]),a=x();return r.a.createElement(l.b,Object.assign({},n,{render:function(e){return a.authStatus.haveTriedLogin?a.authStatus.isConnected?r.a.createElement(t,e):r.a.createElement(l.a,{to:{pathname:"/",state:{from:e.location}}}):r.a.createElement(M,e)}}))},oe=(n(158),function(){return r.a.createElement(i.a,null,r.a.createElement(I,null,r.a.createElement(l.d,null,r.a.createElement(l.b,{exact:!0,path:"/",component:D}),r.a.createElement(l.b,{exact:!0,path:"/login",component:P}),r.a.createElement(re,{exact:!0,path:"/dashboard",comp:ae}),r.a.createElement(l.b,{path:"*",component:function(){return r.a.createElement(l.a,{to:"/"})}}))))});Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(r.a.createElement(oe,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()}))}},[[132,1,2]]]);
//# sourceMappingURL=main.d4bcd480.chunk.js.map